import{c as F,j as t,r as a,a as P,H as B}from"./app-38vMeFEA.js";import{M as D,B as _}from"./MainLayout-B53HLPUF.js";/* empty css            */function R(C){const e=F.c(26),{title:b,coinYield:r,description:c,checked:d,onToggle:m,type:g}=C,h=d===void 0?!1:d,v=`flex items-stretch gap-4 rounded-sm p-2 shadow-lg text-white ${(g===void 0?"daily":g)==="weekly"?"bg-[#087592]":"bg-[#4D9EB3]"}`;let o;e[0]!==m?(o=s=>m?.(s.target.checked),e[0]=m,e[1]=o):o=e[1];const y=h?"bg-[#0FA958] border-[#FA958]":"bg-white border-white";let u;e[2]!==y?(u=["peer h-8 w-8 appearance-none rounded-full cursor-pointer border-2 transition-all",y],e[2]=y,e[3]=u):u=e[3];const p=u.join(" ");let n;e[4]!==h||e[5]!==o||e[6]!==p?(n=t.jsx("input",{type:"checkbox",checked:h,onChange:o,className:p}),e[4]=h,e[5]=o,e[6]=p,e[7]=n):n=e[7];let i;e[8]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx("span",{className:"pointer-events-none absolute inset-0 flex items-center justify-center text-xl font-bold text-white opacity-0 transition-opacity peer-checked:opacity-100",children:"âœ“"}),e[8]=i):i=e[8];let x;e[9]!==n?(x=t.jsxs("label",{className:"relative flex flex-shrink-0 items-center justify-center",children:[n,i]}),e[9]=n,e[10]=x):x=e[10];let j;e[11]!==b?(j=t.jsx("h3",{className:"text-lg font-poppins font-semibold leading-tight",children:b}),e[11]=b,e[12]=j):j=e[12];let L;e[13]===Symbol.for("react.memo_cache_sentinel")?(L=t.jsx("img",{src:"Assets/coin.png",alt:"Coin",className:"h-4 w-4"}),e[13]=L):L=e[13];let w;e[14]!==r?(w=t.jsxs("div",{className:"flex items-center gap-1",children:[L,t.jsx("div",{className:"text-white text-xs font-poppins font-bold",children:r})]}),e[14]=r,e[15]=w):w=e[15];let T;e[16]!==c?(T=t.jsx("p",{className:"text-sm leading-relaxed text-white font-poppins",children:c}),e[16]=c,e[17]=T):T=e[17];let N;e[18]!==j||e[19]!==w||e[20]!==T?(N=t.jsx("div",{className:"flex flex-1 flex-col gap-3",children:t.jsxs("div",{className:"flex flex-col gap-1",children:[j,w,T]})}),e[18]=j,e[19]=w,e[20]=T,e[21]=N):N=e[21];let A;return e[22]!==x||e[23]!==N||e[24]!==v?(A=t.jsxs("div",{className:v,children:[x,N]}),e[22]=x,e[23]=N,e[24]=v,e[25]=A):A=e[25],A}function M(C){const e=F.c(18),{open:b,phase:r,collectible:c,onRequestClose:d}=C,[m,g]=a.useState(!1);let h,E;e[0]!==b||e[1]!==r?(h=()=>{if(!b){g(!1);return}g(r==="revealed")},E=[b,r],e[0]=b,e[1]=r,e[2]=h,e[3]=E):(h=e[2],E=e[3]),a.useEffect(h,E);let O;e:{if(r==="revealed"){O="You got:";break e}O="Opening..."}const v=O;if(!b)return null;let o;e[4]!==m||e[5]!==d?(o=()=>{m&&d?.()},e[4]=m,e[5]=d,e[6]=o):o=e[6];const y=o,u=r==="revealed"&&c;let p;e[7]!==v?(p=t.jsx("div",{className:"text-white font-poppins font-semibold text-xl",children:v}),e[7]=v,e[8]=p):p=e[8];let n;e[9]!==c||e[10]!==u?(n=u?t.jsxs("div",{className:"flex flex-col items-center gap-3",children:[t.jsx("img",{src:c.image,alt:c.name,className:"h-52 w-52 lootbox-pop",draggable:!1}),t.jsxs("div",{className:"text-white font-poppins font-semibold text-lg text-center",children:[c.name," (",c.rarity,")"]}),t.jsx("span",{className:"text-gray-400 font-poppins text-sm text-center",children:"Click anywhere to close"})]}):t.jsx("img",{src:"Assets/present-box.png",alt:"Lootbox",className:"h-52 w-52 lootbox-shake",draggable:!1}),e[9]=c,e[10]=u,e[11]=n):n=e[11];let i;e[12]!==p||e[13]!==n?(i=t.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[p,n]}),e[12]=p,e[13]=n,e[14]=i):i=e[14];let x;return e[15]!==y||e[16]!==i?(x=t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",role:"dialog","aria-modal":"true",onClick:y,children:i}),e[15]=y,e[16]=i,e[17]=x):x=e[17],x}function Y(){const[C,e]=a.useState([]),[b,r]=a.useState(!0),[c,d]=a.useState(""),{setCurrency:m}=P(),g=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",h=a.useCallback(async()=>{r(!0),d("");try{const s=await fetch("/tasks/data",{headers:{Accept:"application/json"},credentials:"same-origin"});if(!s.ok)throw new Error("Failed to fetch tasks");const f=await s.json();e(f.tasks||[]),m(f.currency??0)}catch{d("Unable to load tasks. Please try again.")}finally{r(!1)}},[m]);a.useEffect(()=>{h()},[h]);const E=a.useCallback(async(s,f)=>{if(d(""),e(k=>k.map(l=>l.id===s?{...l,checked:f}:l)),!!f)try{const k=await fetch(`/tasks/${s}/complete`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":g},credentials:"same-origin"}),l=await k.json();if(!k.ok||l.ok===!1)throw new Error(l.error||"Update failed");m(l.currency??0),e(S=>S.map(U=>U.id===s?{...U,checked:l.checked??!0}:U))}catch{e(l=>l.map(S=>S.id===s?{...S,checked:!f}:S)),d("Unable to update task. Please try again.")}},[g]),O=a.useMemo(()=>C.filter(s=>s.type==="daily"),[C]),v=a.useMemo(()=>C.filter(s=>s.type==="weekly"),[C]),[o,y]=a.useState(!1),[u,p]=a.useState(null),[n,i]=a.useState(!1),[x,j]=a.useState("idle"),[L,w]=a.useState(null),T=200,N=a.useCallback(()=>{i(!1),j("idle"),w(null)},[]),A=a.useCallback(async()=>{if(o)return;d(""),p(null),y(!0),i(!0),j("opening"),w(null);const s=Date.now(),f=900;try{const k=await fetch("/inventory/unlock",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":g},credentials:"same-origin"}),l=await k.json().catch(()=>({}));if(!k.ok||l.ok===!1)throw l.error==="NOT_ENOUGH_CURRENCY"?new Error("Not enough coins"):l.error==="ALL_COLLECTIBLES_OWNED"?new Error("All collectibles already owned"):new Error("Unable to open box. Please try again.");const S=Date.now()-s;S<f&&await new Promise(U=>setTimeout(U,f-S)),m(l.currency??0),p(l.collectible??null),w(l.collectible??null),j("revealed")}catch(k){d(k?.message||"Unable to open box. Please try again."),N()}finally{y(!1)}},[N,g,o]);return t.jsxs(D,{children:[t.jsx(B,{title:"Tasks"}),t.jsx(M,{open:n,phase:x,collectible:L,onRequestClose:N}),t.jsx("div",{className:"min-h-screen bg-[#087592]",children:t.jsx("div",{className:"flex justify-center",children:t.jsx("div",{className:"w-[90%] max-w-[1600px] min-h-screen flex justify-center p-16 bg-[#F9FEFF] backdrop-blur-sm border border-white/20 shadow-2xl",children:t.jsxs("div",{className:"w-full grid gap-10 sm:grid-cols-1 md:grid-cols-3 lg:grid-cols-3 items-start pt-10",children:[t.jsxs("div",{className:" p-3 bg-[#C0DEE5] rounded-sm",children:[t.jsx("h1",{className:"text-3xl font-poppins font-semibold text-gray-800 mb-4",children:"Daily"}),t.jsx("div",{className:"flex flex-col gap-3",children:O.map(s=>t.jsx(R,{...s,onToggle:f=>E(s.id,f)},s.id))})]}),t.jsxs("div",{className:"p-3 bg-[#C0DEE5] rounded-sm",children:[t.jsx("h1",{className:"text-3xl font-poppins font-semibold text-gray-800 mb-4",children:"Weekly"}),t.jsx("div",{className:"flex flex-col gap-3",children:v.map(s=>t.jsx(R,{...s,onToggle:f=>E(s.id,f)},s.id))})]}),t.jsxs("div",{className:"p-3 bg-[#C0DEE5] rounded-sm",children:[t.jsx("h1",{className:"text-3xl font-poppins font-semibold text-gray-800 mb-4 pt-0",children:"Buy a Box"}),t.jsxs("div",{className:"w-[80%] items-center justify-center flex flex-col mx-auto",children:[t.jsx("img",{src:"Assets/present-box.png",alt:"Lootbox",className:"h-50 w-50 mt-20"}),t.jsxs("div",{className:"flex gap-1 pt-2",children:[t.jsx("img",{src:"Assets/coin.png",alt:"Coins",className:"h-7 w-7"}),t.jsx("div",{className:"text-white text-xl font-poppins font-bold",children:T})]}),t.jsx(_,{variant:"secondary",className:"font-semibold text-xl my-16",onClick:A,disabled:o,children:o?"Opening...":"Buy and open"}),c&&t.jsx("div",{className:"text-orange-400 font-poppins font-semibold -mt-10",children:c}),u&&t.jsxs("div",{className:"text-gray-800 font-poppins font-semibold -mt-10",children:["Unlocked: ",u.name," (",u.rarity,")"]})]})]})]})})})})]})}export{Y as default};
